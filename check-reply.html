<!DOCTYPE html>
<html lang="en-CA">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Reply - Light in Silence</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --deep-indigo: #2A3D66;
            --soft-yellow: #F4D06F;
            --warm-white: #FAFAFA;
            --gentle-lavender: #B39CD0;
            --dark-indigo: #1e2e4f;
            --light-yellow: #f8e2a0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            line-height: 1.6;
            color: var(--deep-indigo);
            background-color: var(--warm-white);
            background-image: url('data:image/svg+xml;utf8,<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><rect width="4" height="4" x="8" y="8" rx="2" fill="%23B39CD0" opacity="0.15"/></svg>');
            min-height: 100vh;
        }
        
        /* Header - Same as other pages */
        header {
            background-color: var(--deep-indigo);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0.3rem 0;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--warm-white);
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: transform 0.3s ease;
        }
        
        .logo:hover {
            transform: scale(1.05);
        }
        
        .logo-img {
            height: 32px;
            width: 32px;
            margin-right: 10px;
            background-color: var(--soft-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--deep-indigo);
        }
        
        nav ul {
            display: flex;
            list-style: none;
            align-items: center;
            gap: 1.5rem;
        }
        
        nav ul li a {
            color: var(--warm-white);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }
        
        nav ul li a:hover,
        nav ul li a.active {
            background-color: rgba(244, 208, 111, 0.2);
        }
        
        .login-btn {
            background-color: var(--soft-yellow);
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            color: var(--deep-indigo) !important;
            font-weight: bold;
        }
        
        /* Main Content */
        main {
            padding: 2rem 1rem 4rem;
            min-height: calc(100vh - 140px);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
        }
        
        .page-header h1 {
            font-size: 2.5rem;
            color: var(--deep-indigo);
            margin-bottom: 1rem;
            position: relative;
            display: inline-block;
        }
        
        .page-header h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background-color: var(--soft-yellow);
            border-radius: 2px;
        }
        
        .page-header p {
            font-size: 1.2rem;
            color: var(--gentle-lavender);
            font-style: italic;
        }
        
        /* Check Form */
        .check-form {
            background-color: white;
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: 0 8px 30px rgba(42, 61, 102, 0.1);
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }
        
        .check-form::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background: linear-gradient(90deg, var(--gentle-lavender), var(--soft-yellow), var(--gentle-lavender));
            border-radius: 10px 10px 0 0;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--deep-indigo);
        }
        
        .form-group input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gentle-lavender);
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--soft-yellow);
        }
        
        .code-input {
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .check-btn {
            background-color: var(--soft-yellow);
            color: var(--deep-indigo);
            border: none;
            padding: 1rem 2rem;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 10px rgba(244, 208, 111, 0.4);
        }
        
        .check-btn:hover {
            background-color: var(--light-yellow);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(244, 208, 111, 0.5);
        }
        
        /* Response Display */
        .response-container {
            background-color: white;
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: 0 8px 30px rgba(42, 61, 102, 0.1);
            display: none;
            position: relative;
            overflow: hidden;
        }
        
        .response-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background: linear-gradient(90deg, var(--soft-yellow), var(--gentle-lavender), var(--soft-yellow));
            border-radius: 10px 10px 0 0;
        }
        
        .letter-info {
            background-color: var(--warm-white);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--gentle-lavender);
        }
        
        .letter-info h3 {
            color: var(--deep-indigo);
            margin-bottom: 1rem;
        }
        
        .response-item {
            background-color: var(--warm-white);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--soft-yellow);
        }
        
        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .response-type {
            background-color: var(--soft-yellow);
            color: var(--deep-indigo);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .response-date {
            color: var(--gentle-lavender);
            font-size: 0.9rem;
        }
        
        .response-content {
            line-height: 1.8;
            color: var(--deep-indigo);
        }
        
        /* Error/Success Messages */
        .message {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .message.error {
            background-color: rgba(244, 67, 54, 0.1);
            border-left: 4px solid #f44336;
            color: #d32f2f;
        }
        
        .message.success {
            background-color: rgba(76, 175, 80, 0.1);
            border-left: 4px solid #4caf50;
            color: #388e3c;
        }
        
        /* How to Find Code */
        .help-section {
            background-color: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 30px rgba(42, 61, 102, 0.1);
            margin-bottom: 2rem;
        }
        
        .help-section h3 {
            color: var(--deep-indigo);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .help-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .help-item {
            text-align: center;
            padding: 1rem;
        }
        
        .help-icon {
            width: 60px;
            height: 60px;
            background-color: var(--gentle-lavender);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 1.5rem;
        }
        
        .help-item h4 {
            color: var(--deep-indigo);
            margin-bottom: 0.5rem;
        }
        
        .help-item p {
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* Footer */
        footer {
            background-color: var(--deep-indigo);
            color: var(--warm-white);
            padding: 2rem;
            text-align: center;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                padding: 0.8rem 1rem;
            }
            
            nav ul {
                margin-top: 1rem;
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }
            
            .check-form,
            .response-container,
            .help-section {
                margin: 1rem;
                padding: 2rem;
            }
            
            .page-header h1 {
                font-size: 2rem;
            }
            
            .help-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">
                <div class="logo-img">
                    <i class="fas fa-heart"></i>
                </div>
                <span>Light in Silence</span>
            </a>
            
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="submit.html">Share Your Story</a></li>
                <li><a href="check-reply.html" class="active">Check Reply</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="resources.html">Resources</a></li>
                <li><a href="login.html" class="login-btn">Login</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <div class="container">
            <div class="page-header">
                <h1>Check Your Reply</h1>
                <p>Enter your letter code to see if there's a response waiting for you</p>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-question-circle"></i> Where do I find my letter code?</h3>
                <div class="help-content">
                    <div class="help-item">
                        <div class="help-icon">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <h4>After Submission</h4>
                        <p>You received a unique 6-character code (like "LIS-ABC123") when you submitted your letter</p>
                    </div>
                    <div class="help-item">
                        <div class="help-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <h4>Email Confirmation</h4>
                        <p>If you provided an email address, the code was sent to your email</p>
                    </div>
                    <div class="help-item">
                        <div class="help-icon">
                            <i class="fas fa-bookmark"></i>
                        </div>
                        <h4>Keep It Safe</h4>
                        <p>Save your code somewhere secure - it's the only way to access your replies</p>
                    </div>
                </div>
            </div>
            
            <div class="check-form">
                <div class="message" id="message"></div>
                
                <form onsubmit="checkReply(event)">
                    <div class="form-group">
                        <label for="letterCode">
                            <i class="fas fa-key"></i> Enter Your Letter Code
                        </label>
                        <input type="text" 
                               id="letterCode" 
                               name="letterCode" 
                               class="code-input"
                               placeholder="LIS-ABC123"
                               pattern="[A-Z]{3}-[A-Z0-9]{6}"
                               maxlength="10"
                               required>
                        <small style="color: var(--gentle-lavender); display: block; margin-top: 0.5rem;">
                            Format: LIS-ABC123 (not case sensitive)
                        </small>
                    </div>
                    
                    <button type="submit" class="check-btn">
                        <i class="fas fa-search"></i> Check for Reply
                    </button>
                </form>
            </div>
            
            <div class="response-container" id="responseContainer">
                <h2 style="color: var(--deep-indigo); margin-bottom: 2rem; text-align: center;">
                    <i class="fas fa-reply"></i> Your Response
                </h2>
                
                <div class="letter-info" id="letterInfo">
                    <!-- Letter information will be populated here -->
                </div>
                
                <div id="responsesContainer">
                    <!-- Responses will be populated here -->
                </div>
                
                <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--warm-white);">
                    <p style="color: var(--gentle-lavender); font-style: italic;">
                        Need more support? You can always <a href="submit.html" style="color: var(--deep-indigo); text-decoration: none; font-weight: 600;">submit another letter</a> 
                        or <a href="resources.html" style="color: var(--deep-indigo); text-decoration: none; font-weight: 600;">explore our resources</a>.
                    </p>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <div style="max-width: 1200px; margin: 0 auto;">
            <p>&copy; 2025 Light in Silence. All rights reserved. | Where Your Words Find Light</p>
            <p style="margin-top: 0.5rem;">
                <a href="privacy.html" style="color: var(--soft-yellow); text-decoration: none;">Privacy Policy</a> | 
                <a href="terms.html" style="color: var(--soft-yellow); text-decoration: none;">Terms of Service</a>
            </p>
        </div>
    </footer>

    <script>
        // Auto-format letter code input
        const letterCodeInput = document.getElementById('letterCode');
        
        letterCodeInput.addEventListener('input', function(e) {
            let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            
            if (value.length > 3) {
                value = value.substring(0, 3) + '-' + value.substring(3, 9);
            }
            
            e.target.value = value;
        });
        
        // Check for reply
        function checkReply(event) {
            event.preventDefault();
            
            const letterCode = document.getElementById('letterCode').value.trim().toUpperCase();
            const messageDiv = document.getElementById('message');
            const responseContainer = document.getElementById('responseContainer');
            
            // Clear previous messages
            messageDiv.style.display = 'none';
            responseContainer.style.display = 'none';
            
            // Validate format
            if (!/^LIS-[A-Z0-9]{6}$/.test(letterCode)) {
                showMessage('error', 'Please enter a valid letter code in the format LIS-ABC123');
                return;
            }
            
            // Check localStorage for demo purposes
            const existingLetters = JSON.parse(localStorage.getItem('lightInSilenceLetters') || '[]');
            const letter = existingLetters.find(l => l.id === letterCode);
            
            if (!letter) {
                showMessage('error', 'Letter code not found. Please check your code and try again.');
                return;
            }
            
            // Display letter and response
            displayLetterResponse(letter);
        }
        
        function showMessage(type, text) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'check-circle'}"></i> ${text}`;
            messageDiv.style.display = 'block';
            
            // Scroll to message
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        function displayLetterResponse(letter) {
            const letterInfo = document.getElementById('letterInfo');
            const responsesContainer = document.getElementById('responsesContainer');
            const responseContainer = document.getElementById('responseContainer');
            
            // Format submission date
            const submissionDate = new Date(letter.timestamp).toLocaleDateString('en-CA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Display letter info
            letterInfo.innerHTML = `
                <h3><i class="fas fa-envelope-open"></i> Your Letter</h3>
                <p><strong>Code:</strong> ${letter.id}</p>
                <p><strong>Topic:</strong> ${letter.topic || 'No specific topic'}</p>
                <p><strong>Submitted:</strong> ${submissionDate}</p>
                <p><strong>Status:</strong> <span style="color: var(--soft-yellow); font-weight: 600;">${getLetterStatus(letter)}</span></p>
                <div style="margin-top: 1rem; padding: 1rem; background-color: white; border-radius: 8px; border-left: 3px solid var(--gentle-lavender);">
                    <p style="font-style: italic;">"${letter.content.substring(0, 200)}${letter.content.length > 200 ? '...' : ''}"</p>
                </div>
            `;
            
            // Generate and display responses
            const responses = generateResponses(letter);
            displayResponses(responses);
            
            // Show response container
            responseContainer.style.display = 'block';
            responseContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function getLetterStatus(letter) {
            const hoursSinceSubmission = (new Date() - new Date(letter.timestamp)) / (1000 * 60 * 60);
            
            if (hoursSinceSubmission < 2) {
                return 'Just submitted - Response coming soon';
            } else if (hoursSinceSubmission < 24) {
                return 'Under review - Response within 48 hours';
            } else {
                return 'Response available';
            }
        }
        
        function generateResponses(letter) {
            const responses = [];
            const submissionTime = new Date(letter.timestamp);
            
            // Always generate at least one response for demo
            if (letter.reply_method === 'ai' || letter.reply_method === 'website') {
                // AI Response
                responses.push({
                    type: 'AI Companion',
                    content: generateAIResponse(letter.content),
                    timestamp: new Date(submissionTime.getTime() + 30 * 60 * 1000), // 30 minutes later
                    model: 'Gemini 2.0 Flash'
                });
                
                // Human follow-up (if more than 24 hours)
                const hoursSince = (new Date() - submissionTime) / (1000 * 60 * 60);
                if (hoursSince > 24) {
                    responses.push({
                        type: 'Volunteer Response',
                        content: generateVolunteerResponse(letter.content, letter.topic),
                        timestamp: new Date(submissionTime.getTime() + 26 * 60 * 60 * 1000), // 26 hours later
                        volunteer: 'Anonymous Volunteer'
                    });
                }
            }
            
            return responses;
        }
        
        function generateAIResponse(content) {
            const responses = [
                "Thank you for sharing your thoughts with us. What you're experiencing is valid, and it takes courage to reach out. Remember that difficult feelings are temporary, and seeking support shows strength, not weakness. You're not alone in this journey.",
                
                "I hear you, and I want you to know that your feelings matter. Sometimes life can feel overwhelming, but please remember that you have the strength within you to navigate through this. Consider taking things one day at a time, and don't hesitate to reach out for support when you need it.",
                
                "Your willingness to share your story shows incredible bravery. What you're going through is real and significant. Please be gentle with yourself as you work through these feelings. Remember that healing isn't linear, and it's okay to have both good days and challenging ones.",
                
                "Thank you for trusting us with your words. Your experience is important, and you deserve support and understanding. Consider connecting with friends, family, or a counselor who can provide ongoing support. You don't have to face this alone."
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        function generateVolunteerResponse(content, topic) {
            const responses = {
                academic: "Academic pressure can feel overwhelming, but remember that your worth isn't defined by grades or achievements. Consider breaking large tasks into smaller, manageable steps, and don't forget to celebrate small victories along the way.",
                
                work: "Work stress is something many people face, and it's important to recognize when it's affecting your wellbeing. Consider setting boundaries, taking regular breaks, and speaking with your supervisor about workload concerns if possible.",
                
                relationships: "Relationships can be complex and challenging. Remember that healthy relationships involve mutual respect, communication, and understanding. It's okay to set boundaries and prioritize your own wellbeing.",
                
                mental: "Taking care of your mental health is just as important as physical health. Consider reaching out to a mental health professional who can provide personalized support and strategies.",
                
                default: "Thank you for sharing your story with us. Your feelings are valid, and seeking support shows strength. Remember that you're not alone, and there are people who care about your wellbeing."
            };
            
            return responses[topic] || responses.default;
        }
        
        function displayResponses(responses) {
            const container = document.getElementById('responsesContainer');
            container.innerHTML = '';
            
            responses.forEach((response, index) => {
                const responseDiv = document.createElement('div');
                responseDiv.className = 'response-item';
                responseDiv.style.animationDelay = `${index * 0.2}s`;
                
                const responseDate = response.timestamp.toLocaleDateString('en-CA', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                responseDiv.innerHTML = `
                    <div class="response-header">
                        <span class="response-type">
                            <i class="fas fa-${response.type.includes('AI') ? 'robot' : 'user'}"></i> 
                            ${response.type}
                        </span>
                        <span class="response-date">${responseDate}</span>
                    </div>
                    <div class="response-content">
                        <p>${response.content}</p>
                        ${response.model ? `<p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.7;"><em>Generated by ${response.model}</em></p>` : ''}
                    </div>
                `;
                
                container.appendChild(responseDiv);
            });
            
            if (responses.length === 0) {
                container.innerHTML = `
                    <div class="response-item">
                        <div class="response-content">
                            <p style="text-align: center; color: var(--gentle-lavender);">
                                <i class="fas fa-clock"></i> No responses yet. 
                                Our volunteers typically respond within 48 hours.
                            </p>
                        </div>
                    </div>
                `;
            }
        }
        
        // Check URL parameters for direct access
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const letterCode = urlParams.get('code');
            
            if (letterCode) {
                document.getElementById('letterCode').value = letterCode;
                document.querySelector('.check-form form').dispatchEvent(new Event('submit'));
            }
        });
    </script>
</body>
</html> 