<!DOCTYPE html>
<html lang="en-CA">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respond to Letter - Light in Silence</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --deep-indigo: #2A3D66;
            --soft-yellow: #F4D06F;
            --warm-white: #FAFAFA;
            --gentle-lavender: #B39CD0;
            --light-yellow: #f8e2a0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            line-height: 1.6;
            color: var(--deep-indigo);
            background: linear-gradient(135deg, var(--warm-white), rgba(179, 156, 208, 0.1));
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background-color: var(--deep-indigo);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 0.3rem 0;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--warm-white);
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: transform 0.3s ease;
        }
        
        .logo:hover { transform: scale(1.05); }
        
        .logo-img {
            height: 32px;
            width: 32px;
            margin-right: 10px;
            background-color: var(--soft-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--deep-indigo);
        }
        
        nav ul {
            display: flex;
            list-style: none;
            align-items: center;
            gap: 1.5rem;
        }
        
        nav ul li a {
            color: var(--warm-white);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }
        
        nav ul li a:hover {
            background-color: rgba(244, 208, 111, 0.2);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            flex: 1;
        }

        .response-header {
            background: linear-gradient(135deg, var(--gentle-lavender), #e8d5f2);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            color: var(--deep-indigo);
        }

        .response-header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .back-button {
            background: var(--deep-indigo);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .back-button:hover {
            background: #1e2a47;
            transform: translateY(-2px);
        }

        .letter-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(42, 61, 102, 0.08);
            border-left: 5px solid var(--gentle-lavender);
        }

        .letter-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--warm-white);
            flex-wrap: wrap;
            gap: 15px;
        }

        .letter-topic {
            background: var(--gentle-lavender);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .letter-date {
            color: #666;
            font-size: 1rem;
            font-weight: 600;
        }

        .letter-content {
            background: var(--warm-white);
            padding: 25px;
            border-radius: 15px;
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--deep-indigo);
        }

        .response-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(42, 61, 102, 0.08);
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--deep-indigo);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .response-type-selector {
            display: flex;
            background: var(--warm-white);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 25px;
            gap: 5px;
            flex-wrap: wrap;
        }

        .response-type {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--deep-indigo);
            min-width: 140px;
        }

        .response-type.active {
            background: var(--soft-yellow);
            color: var(--deep-indigo);
        }

        .response-type:hover:not(.active) {
            background: var(--light-yellow);
        }

        .ai-assist-section {
            background: #f0f8ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid #2196f3;
        }

        .ai-assist-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #1976d2;
            font-weight: 700;
        }

        .ai-suggestions {
            display: grid;
            gap: 10px;
            margin-bottom: 15px;
        }

        .ai-suggestion {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e3f2fd;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ai-suggestion:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
        }

        .generate-ai-btn {
            background: #2196f3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .generate-ai-btn:hover {
            background: #1976d2;
        }

        .response-textarea {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1.1rem;
            font-family: inherit;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .response-textarea:focus {
            outline: none;
            border-color: var(--gentle-lavender);
        }

        .char-counter {
            text-align: right;
            margin-top: 10px;
            color: #666;
            font-size: 0.9rem;
        }

        .submit-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--soft-yellow);
            color: var(--deep-indigo);
        }

        .btn-primary:hover {
            background: var(--light-yellow);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--gentle-lavender);
            color: white;
        }

        .btn-secondary:hover {
            background: #9b7cb8;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #ff5722;
            color: white;
        }

        .btn-danger:hover {
            background: #e64a19;
            transform: translateY(-2px);
        }

        .crisis-resources {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .crisis-header {
            color: #d32f2f;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .crisis-contacts {
            display: grid;
            gap: 10px;
        }

        .crisis-contact {
            background: white;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        footer {
            background-color: var(--deep-indigo);
            color: var(--warm-white);
            padding: 2rem;
            text-align: center;
            margin-top: auto;
        }

        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                padding: 0.8rem 1rem;
            }
            
            nav ul {
                margin-top: 1rem;
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }

            .container {
                padding: 1rem;
            }

            .response-header h1 {
                font-size: 1.8rem;
                flex-direction: column;
                gap: 10px;
            }

            .letter-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .response-type-selector {
                flex-direction: column;
            }

            .submit-section {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">
                <div class="logo-img">
                    <i class="fas fa-heart"></i>
                </div>
                <span>Light in Silence</span>
            </a>
            
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="volunteer-dashboard.html">Dashboard</a></li>
                <li><a href="admin-dashboard.html" id="adminLink" style="display: none;">Admin</a></li>
                <li><a href="submit.html">Share Your Story</a></li>
                <li><a href="check-reply.html">Check Reply</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="resources.html">Resources</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <div class="container">
            <a href="volunteer-dashboard.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
                Back to Dashboard
            </a>

            <!-- Response Header -->
            <div class="response-header">
                <h1>
                    <i class="fas fa-reply"></i>
                    Respond to Letter
                </h1>
                <p>Provide compassionate support to someone who needs it</p>
            </div>

            <!-- Original Letter -->
            <div class="letter-section">
                <div class="section-title">
                    <i class="fas fa-envelope"></i>
                    Original Letter
                </div>
                <div class="letter-meta">
                    <span class="letter-topic" id="letterTopic">Loading...</span>
                    <span class="letter-date" id="letterDate">Loading...</span>
                </div>
                <div class="letter-content" id="letterContent">
                    Loading letter content...
                </div>
            </div>

            <!-- Crisis Resources (shown for flagged content) -->
            <div class="crisis-resources" id="crisisResources" style="display: none;">
                <div class="crisis-header">
                    <i class="fas fa-exclamation-triangle"></i>
                    Crisis Resources - Consider Including These
                </div>
                <div class="crisis-contacts">
                    <div class="crisis-contact">
                        <span><strong>Canada Crisis Line:</strong> 24/7 support</span>
                        <span><strong>1-833-456-4566</strong></span>
                    </div>
                    <div class="crisis-contact">
                        <span><strong>Text Support:</strong> Text for help</span>
                        <span><strong>45645</strong></span>
                    </div>
                    <div class="crisis-contact">
                        <span><strong>Emergency Services:</strong> Immediate help</span>
                        <span><strong>911</strong></span>
                    </div>
                </div>
            </div>

            <!-- Response Section -->
            <div class="response-section">
                <div class="section-title">
                    <i class="fas fa-heart"></i>
                    Your Response
                </div>

                <!-- Response Type Selector -->
                <div class="response-type-selector">
                    <button class="response-type active" onclick="selectResponseType('human')">
                        <i class="fas fa-user"></i> Human Only
                    </button>
                    <button class="response-type" onclick="selectResponseType('ai-assisted')">
                        <i class="fas fa-robot"></i> AI Assisted
                    </button>
                    <button class="response-type" onclick="selectResponseType('hybrid')">
                        <i class="fas fa-users"></i> Hybrid Response
                    </button>
                </div>

                <!-- AI Assistance Section -->
                <div class="ai-assist-section" id="aiAssistSection" style="display: none;">
                    <div class="ai-assist-header">
                        <i class="fas fa-magic"></i>
                        AI Response Suggestions
                    </div>
                    <div class="ai-suggestions" id="aiSuggestions">
                        <!-- AI suggestions will be loaded here -->
                    </div>
                    <button class="generate-ai-btn" onclick="generateAIResponse()">
                        <i class="fas fa-sync-alt"></i>
                        Generate New Suggestions
                    </button>
                </div>

                <!-- Response Textarea -->
                <textarea 
                    class="response-textarea" 
                    id="responseText" 
                    placeholder="Write your compassionate response here... Remember to be supportive, non-judgmental, and helpful. Consider the person's feelings and provide hope where appropriate."
                ></textarea>
                <div class="char-counter">
                    <span id="charCount">0</span> / 5000 characters
                </div>

                <!-- Submit Section -->
                <div class="submit-section">
                    <div>
                        <button class="btn btn-primary" onclick="submitResponse()">
                            <i class="fas fa-paper-plane"></i>
                            Send Response
                        </button>
                        <button class="btn btn-secondary" onclick="saveDraft()">
                            <i class="fas fa-save"></i>
                            Save Draft
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="escalateToAdmin()" id="escalateBtn" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i>
                            Escalate to Admin
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <div style="max-width: 1200px; margin: 0 auto;">
            <p>&copy; 2025 Light in Silence. All rights reserved. | Where Your Words Find Light</p>
            <p style="margin-top: 0.5rem;">
                Thank you for providing compassionate support to our community.
            </p>
        </div>
    </footer>

    <script>
        // Demo letter data
        const demoLetters = {
            'letter-001': {
                topic: 'Academic Pressure',
                content: 'I\'ve been struggling with overwhelming pressure at university. Every assignment feels like a mountain I can\'t climb, and I\'m constantly comparing myself to my classmates. Some days I wonder if I\'m even smart enough to be here. The stress is affecting my sleep and I feel like I\'m falling behind everyone else. I don\'t want to disappoint my family but I\'m really struggling.',
                date: '2025-01-08 14:30',
                flagged: false
            },
            'letter-002': {
                topic: 'Mental Health',
                content: 'I\'ve been feeling really down lately and nothing seems to bring me joy anymore. Even things I used to love feel pointless. I don\'t want to worry my family but I think I might need help. Sometimes I have really dark thoughts and I don\'t know what to do with them.',
                date: '2025-01-07 22:45',
                flagged: true
            },
            'letter-003': {
                topic: 'Relationships',
                content: 'My best friend and I had a huge fight last week and we haven\'t spoken since. I know I should reach out, but I\'m scared they hate me now. This friendship means everything to me and I don\'t know how to fix things. I keep replaying the argument in my head.',
                date: '2025-01-08 09:15',
                flagged: false
            }
        };

        let currentLetter = null;
        let selectedResponseType = 'human';

        // Get letter ID from URL parameters
        function getLetterIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || 'letter-001'; // Default to first letter
        }

        // Check authentication and role access
        function checkAuth() {
            const userSession = localStorage.getItem('lightInSilenceUser');
            if (!userSession) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const session = JSON.parse(userSession);
                if (session.userType !== 'volunteer' && session.userType !== 'admin') {
                    alert('Access denied. Volunteer privileges required.');
                    window.location.href = 'login.html';
                    return;
                }

                // Show admin link if user is admin
                if (session.userType === 'admin') {
                    document.getElementById('adminLink').style.display = 'block';
                }
                
            } catch (e) {
                localStorage.removeItem('lightInSilenceUser');
                window.location.href = 'login.html';
            }
        }

        // Load letter content
        function loadLetter() {
            const letterId = getLetterIdFromUrl();
            currentLetter = demoLetters[letterId];

            if (!currentLetter) {
                alert('Letter not found. Redirecting to dashboard.');
                window.location.href = 'volunteer-dashboard.html';
                return;
            }

            // Update letter display
            document.getElementById('letterTopic').textContent = currentLetter.topic || 'No Topic';
            document.getElementById('letterDate').textContent = new Date(currentLetter.date).toLocaleDateString('en-CA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('letterContent').textContent = currentLetter.content;

            // Show crisis resources and escalate button for flagged content
            if (currentLetter.flagged) {
                document.getElementById('crisisResources').style.display = 'block';
                document.getElementById('escalateBtn').style.display = 'block';
            }
        }

        // Select response type
        function selectResponseType(type) {
            selectedResponseType = type;
            
            // Update active button
            document.querySelectorAll('.response-type').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.response-type').classList.add('active');

            // Show/hide AI assistance
            const aiSection = document.getElementById('aiAssistSection');
            if (type === 'ai-assisted' || type === 'hybrid') {
                aiSection.style.display = 'block';
                if (!document.getElementById('aiSuggestions').innerHTML) {
                    generateAIResponse();
                }
            } else {
                aiSection.style.display = 'none';
            }
        }

        // Generate AI response suggestions
        function generateAIResponse() {
            const suggestions = [
                {
                    type: 'Supportive',
                    text: 'Thank you for sharing your feelings with us. What you\'re experiencing sounds really challenging, and it takes courage to reach out. Please know that you\'re not alone in feeling this way.'
                },
                {
                    type: 'Practical',
                    text: 'It sounds like you\'re going through a difficult time. Have you considered speaking with a counselor or trusted friend about these feelings? Sometimes having someone to talk to can really help.'
                },
                {
                    type: 'Encouraging',
                    text: 'I hear how much you\'re struggling right now, and I want you to know that these feelings, while overwhelming, are temporary. You\'ve shown strength by reaching out, and that\'s an important first step.'
                }
            ];

            const suggestionsContainer = document.getElementById('aiSuggestions');
            suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                <div class="ai-suggestion" onclick="useAISuggestion('${suggestion.text}')">
                    <strong>${suggestion.type}:</strong> ${suggestion.text}
                </div>
            `).join('');
        }

        // Use AI suggestion
        function useAISuggestion(text) {
            const textarea = document.getElementById('responseText');
            const currentText = textarea.value;
            
            if (currentText) {
                textarea.value = currentText + '\n\n' + text;
            } else {
                textarea.value = text;
            }
            
            updateCharCount();
        }

        // Update character count
        function updateCharCount() {
            const textarea = document.getElementById('responseText');
            const charCount = document.getElementById('charCount');
            charCount.textContent = textarea.value.length;
            
            if (textarea.value.length > 5000) {
                charCount.style.color = '#f44336';
            } else {
                charCount.style.color = '#666';
            }
        }

        // Submit response
        function submitResponse() {
            const responseText = document.getElementById('responseText').value.trim();
            
            if (!responseText) {
                alert('Please write a response before submitting.');
                return;
            }

            if (responseText.length > 5000) {
                alert('Response is too long. Please keep it under 5000 characters.');
                return;
            }

            if (confirm('Are you sure you want to send this response? This action cannot be undone.')) {
                // Simulate sending response
                showNotification('Response sent successfully! The person will be notified.', 'success');
                
                // Redirect to dashboard after delay
                setTimeout(() => {
                    window.location.href = 'volunteer-dashboard.html';
                }, 2000);
            }
        }

        // Save draft
        function saveDraft() {
            const responseText = document.getElementById('responseText').value.trim();
            
            if (!responseText) {
                alert('Please write something before saving a draft.');
                return;
            }

            // Save to localStorage (in real app, would save to server)
            const letterId = getLetterIdFromUrl();
            localStorage.setItem(`draft_${letterId}`, JSON.stringify({
                text: responseText,
                type: selectedResponseType,
                savedAt: new Date().toISOString()
            }));

            showNotification('Draft saved successfully!', 'success');
        }

        // Load saved draft
        function loadDraft() {
            const letterId = getLetterIdFromUrl();
            const draft = localStorage.getItem(`draft_${letterId}`);
            
            if (draft) {
                try {
                    const draftData = JSON.parse(draft);
                    document.getElementById('responseText').value = draftData.text;
                    updateCharCount();
                    showNotification('Draft loaded!', 'info');
                } catch (e) {
                    console.error('Error loading draft:', e);
                }
            }
        }

        // Escalate to admin
        function escalateToAdmin() {
            if (confirm('Escalate this letter to an administrator for review? This will flag it for immediate admin attention.')) {
                showNotification('Letter has been escalated to administration for review.', 'warning');
                
                setTimeout(() => {
                    window.location.href = 'volunteer-dashboard.html';
                }, 2000);
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const colors = {
                success: '#4caf50',
                error: '#f44336',
                warning: '#ff9800',
                info: '#2196f3'
            };

            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type]};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                max-width: 350px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Logout function
        function logout() {
            localStorage.removeItem('lightInSilenceUser');
            window.location.href = 'login.html';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadLetter();
            loadDraft();
            
            // Set up character counter
            document.getElementById('responseText').addEventListener('input', updateCharCount);
        });
    </script>
</body>
</html> 